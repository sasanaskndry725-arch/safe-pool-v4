<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŠ Safe Pool Smart | Ø§Ø³ØªØ®Ø± Ø§ÛŒÙ…Ù† Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    
    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ SafePal -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    
    <!-- Ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-glow: #818cf8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --accent-glow: #fbbf24;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-glow: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Vazirmatn', system-ui, -apple-system, sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .light-beam {
            position: fixed;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(100px);
            z-index: -2;
            animation: beamFloat 20s infinite alternate ease-in-out;
            pointer-events: none;
        }
        
        .light-beam-1 {
            top: -300px;
            left: -300px;
            animation-delay: 0s;
        }
        
        .light-beam-2 {
            bottom: -300px;
            right: -300px;
            animation-delay: 10s;
        }
        
        @keyframes beamFloat {
            0% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(150px, 80px) scale(1.1); }
            50% { transform: translate(-100px, 150px) scale(0.9); }
            75% { transform: translate(200px, -50px) scale(1.05); }
            100% { transform: translate(-150px, -150px) scale(1); }
        }
        
        .particle-grid {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(99, 102, 241, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.1) 1px, transparent 1px);
            background-size: 80px 80px, 100px 100px;
            animation: gridMove 40s linear infinite;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 80px 80px, 100px 100px; }
        }
        
        .main-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 25px;
            position: relative;
            z-index: 1;
        }
        
        .main-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 45px 30px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            animation: rainbowBorder 3s linear infinite;
        }
        
        @keyframes rainbowBorder {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .logo-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .logo-orb {
            width: 120px;
            height: 120px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            box-shadow: 
                0 0 80px rgba(99, 102, 241, 0.7),
                inset 0 0 30px rgba(255, 255, 255, 0.3);
            animation: 
                orbPulse 2s infinite,
                orbFloat 6s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .logo-orb::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: orbRotate 4s linear infinite;
        }
        
        @keyframes orbPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 80px rgba(99, 102, 241, 0.7); }
            50% { transform: scale(1.08); box-shadow: 0 0 100px rgba(99, 102, 241, 0.9); }
        }
        
        @keyframes orbFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(3deg); }
            66% { transform: translateY(15px) rotate(-3deg); }
        }
        
        @keyframes orbRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .logo-title {
            font-size: 46px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            letter-spacing: -1px;
            text-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        .logo-subtitle {
            font-size: 18px;
            color: #94a3b8;
            font-weight: 300;
            letter-spacing: 1.5px;
        }
        
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 28px;
            padding: 40px 35px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .glass-card:hover {
            transform: translateY(-12px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.4),
                0 0 120px rgba(99, 102, 241, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .header-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.5);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }
        
        .glass-card:hover .header-icon {
            transform: scale(1.15) rotate(12deg);
            box-shadow: 0 20px 45px rgba(99, 102, 241, 0.7);
        }
        
        .header-icon::before {
            content: '';
            position: absolute;
            width: 250%;
            height: 250%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            animation: iconShine 4s infinite;
        }
        
        @keyframes iconShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        .card-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--light);
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn {
            width: 100%;
            padding: 26px;
            border: none;
            border-radius: 22px;
            font-size: 22px;
            font-weight: 800;
            margin: 22px 0;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 22px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.8px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: 1s;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        .action-btn:hover {
            transform: translateY(-8px) scale(1.03);
            filter: brightness(1.15);
        }
        
        .action-btn:active {
            transform: translateY(-2px) scale(0.98);
        }
        
        .connect-btn {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 
                0 20px 45px rgba(99, 102, 241, 0.5),
                0 0 70px rgba(99, 102, 241, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.25);
            animation: 
                btnPulse 2.5s infinite,
                borderGlow 3.5s infinite;
        }
        
        @keyframes btnPulse {
            0%, 100% { box-shadow: 0 20px 45px rgba(99, 102, 241, 0.5), 0 0 70px rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 25px 55px rgba(99, 102, 241, 0.7), 0 0 90px rgba(99, 102, 241, 0.6); }
        }
        
        @keyframes borderGlow {
            0%, 100% { border-color: rgba(255, 255, 255, 0.25); }
            50% { border-color: rgba(255, 255, 255, 0.5); }
        }
        
        .success-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, #34d399 100%);
            color: white;
            box-shadow: 0 20px 45px rgba(16, 185, 129, 0.5);
        }
        
        .warning-btn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-glow) 100%);
            color: white;
            box-shadow: 0 20px 45px rgba(245, 158, 11, 0.5);
        }
        
        .wallet-panel {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
            border-radius: 28px;
            padding: 35px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: none;
            animation: 
                panelSlide 0.8s ease,
                panelGlow 5s infinite alternate;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        
        @keyframes panelSlide {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes panelGlow {
            0% { box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 50px rgba(99, 102, 241, 0.3); }
            100% { box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 80px rgba(99, 102, 241, 0.5); }
        }
        
        .wallet-display {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-radius: 24px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .wallet-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            animation: slowRotate 25s linear infinite;
        }
        
        @keyframes slowRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .wallet-address {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.4);
            padding: 22px;
            border-radius: 18px;
            word-break: break-all;
            font-size: 17px;
            color: #60a5fa;
            margin: 25px 0;
            border: 1px solid rgba(96, 165, 250, 0.4);
            position: relative;
            padding-right: 70px;
            backdrop-filter: blur(15px);
        }
        
        .wallet-address::before {
            content: 'ğŸ”—';
            position: absolute;
            left: 22px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 22px;
        }
        
        .balance-display {
            font-size: 56px;
            font-weight: 900;
            color: var(--secondary);
            text-align: center;
            margin: 35px 0;
            text-shadow: 
                0 5px 25px rgba(16, 185, 129, 0.5),
                0 0 50px rgba(16, 185, 129, 0.4);
            animation: balanceGlow 4s infinite alternate;
        }
        
        @keyframes balanceGlow {
            0% { text-shadow: 0 5px 25px rgba(16, 185, 129, 0.5), 0 0 50px rgba(16, 185, 129, 0.4); }
            100% { text-shadow: 0 5px 35px rgba(16, 185, 129, 0.7), 0 0 70px rgba(16, 185, 129, 0.6); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 35px;
        }
        
        .stat-orb {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }
        
        .stat-orb:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: var(--primary);
            box-shadow: 
                0 20px 40px rgba(99, 102, 241, 0.4),
                0 0 60px rgba(99, 102, 241, 0.3);
        }
        
        .stat-orb::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s ease;
        }
        
        .stat-orb:hover::before {
            transform: scaleX(1);
        }
        
        .stat-value {
            font-size: 38px;
            font-weight: 900;
            margin: 20px 0;
            color: var(--primary);
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
        }
        
        .stat-label {
            font-size: 15px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }
        
        .form-group {
            margin: 30px 0;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 20px;
            font-weight: 800;
            color: #e2e8f0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .form-input {
            width: 100%;
            padding: 24px;
            border: 2px solid #334155;
            border-radius: 20px;
            background: rgba(15, 23, 42, 0.8);
            color: white;
            font-size: 19px;
            font-family: inherit;
            transition: all 0.5s ease;
            box-shadow: inset 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 
                inset 0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(99, 102, 241, 0.4);
            background: rgba(15, 23, 42, 0.95);
            transform: translateY(-5px);
        }
        
        .special-box {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.25) 0%, rgba(217, 119, 6, 0.25) 100%);
            border-radius: 28px;
            padding: 35px;
            margin: 35px 0;
            border: 1px solid rgba(245, 158, 11, 0.5);
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: boxFloat 7s ease-in-out infinite;
        }
        
        @keyframes boxFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .special-box::before {
            content: 'âœ¨';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 50px;
            opacity: 0.5;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.3); }
        }
        
        .special-amount {
            font-size: 64px;
            font-weight: 900;
            color: #f59e0b;
            margin: 25px 0;
            text-shadow: 
                0 5px 25px rgba(245, 158, 11, 0.5),
                0 0 60px rgba(245, 158, 11, 0.4);
            animation: amountPulse 4s infinite alternate;
        }
        
        @keyframes amountPulse {
            0% { text-shadow: 0 5px 25px rgba(245, 158, 11, 0.5), 0 0 60px rgba(245, 158, 11, 0.4); }
            100% { text-shadow: 0 5px 35px rgba(245, 158, 11, 0.7), 0 0 80px rgba(245, 158, 11, 0.6); }
        }
        
        .main-footer {
            text-align: center;
            margin-top: 60px;
            padding: 45px 35px;
            color: #64748b;
            font-size: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            backdrop-filter: blur(15px);
            border-radius: 32px;
            background: var(--glass);
        }
        
        .contract-display {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.4);
            padding: 20px 30px;
            border-radius: 18px;
            margin: 25px 0;
            font-size: 14px;
            color: #94a3b8;
            border: 1px solid rgba(255, 255, 255, 0.08);
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }
        
        .contract-display::before {
            content: 'ğŸ”';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 22px;
        }
        
        .advanced-notification {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(-120px);
            padding: 28px 40px;
            border-radius: 24px;
            color: white;
            font-weight: 800;
            z-index: 2000;
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.5),
                0 0 80px rgba(99, 102, 241, 0.4);
            backdrop-filter: blur(35px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 90%;
            text-align: center;
            opacity: 0;
            font-size: 18px;
        }
        
        .advanced-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .advanced-notification.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.97) 0%, rgba(5, 150, 105, 0.97) 100%);
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .advanced-notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.97) 0%, rgba(220, 38, 38, 0.97) 100%);
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .advanced-notification.info {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.97) 0%, rgba(79, 70, 229, 0.97) 100%);
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }
        
        .advanced-loader {
            width: 28px;
            height: 28px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            display: inline-block;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 480px) {
            .main-container { padding: 20px; }
            .main-header { padding: 35px 25px; }
            .logo-title { font-size: 38px; }
            .glass-card { padding: 35px 25px; }
            .action-btn { padding: 24px; font-size: 20px; }
            .balance-display { font-size: 48px; }
            .special-amount { font-size: 54px; }
            .stats-grid { grid-template-columns: 1fr; gap: 20px; }
            .form-input { padding: 22px; }
        }
    </style>
</head>
<body>
    <div class="light-beam light-beam-1"></div>
    <div class="light-beam light-beam-2"></div>
    
    <div class="particle-grid"></div>
    
    <div id="notification" class="advanced-notification"></div>
    
    <div class="main-container">
        <header class="main-header">
            <div class="logo-wrapper">
                <div class="logo-orb">
                    <i class="fas fa-infinity"></i>
                </div>
                <div>
                    <h1 class="logo-title">SPS MATRIX</h1>
                    <p class="logo-subtitle">Ø³ÛŒØ³ØªÙ… Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ø³Ù„ Ø¢ÛŒÙ†Ø¯Ù‡</p>
                </div>
            </div>
            
            <div style="margin-top: 25px;">
                <span style="display: inline-block; background: var(--gradient-primary); color: white; padding: 12px 32px; border-radius: 50px; font-size: 16px; font-weight: 700; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);">
                    <i class="fas fa-bolt"></i> SafePal Optimized v4.0
                </span>
            </div>
        </header>
        
        <div class="glass-card">
            <div class="card-header">
                <div class="header-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <h2 class="card-title">Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„</h2>
            </div>
            
            <button class="action-btn connect-btn" id="connectBtn">
                <i class="fas fa-plug"></i>
                <span id="connectText">Ø§ØªØµØ§Ù„ SafePal Wallet</span>
            </button>
            
            <div id="userPanel" class="wallet-panel">
                <h3 style="margin-bottom: 30px; color: #e2e8f0; display: flex; align-items: center; gap: 20px; font-size: 26px;">
                    <i class="fas fa-user-check" style="color: var(--secondary); font-size: 32px;"></i>
                    Ø­Ø³Ø§Ø¨ Ù…ØªØµÙ„ Ø´Ø¯Ù‡
                </h3>
                
                <div class="wallet-display">
                    <div class="form-label">
                        <i class="fas fa-address-card"></i>
                        Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„:
                    </div>
                    <div class="wallet-address" id="walletAddress"></div>
                    
                    <div style="text-align: center; margin: 40px 0;">
                        <div class="form-label" style="justify-content: center;">
                            <i class="fas fa-coins"></i>
                            Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨:
                        </div>
                        <div class="balance-display">
                            <span id="balance">0.00</span> <span style="font-size: 30px;">MATIC</span>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-orb">
                            <div class="stat-label">Ø´Ø¨Ú©Ù‡</div>
                            <div class="stat-value" id="network">Polygon</div>
                        </div>
                        <div class="stat-orb">
                            <div class="stat-label">ÙˆØ¶Ø¹ÛŒØª</div>
                            <div class="stat-value" id="status" style="color: var(--secondary);">Ù…ØªØµÙ„</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="glass-card">
            <div class="card-header">
                <div class="header-icon" style="background: linear-gradient(135deg, var(--secondary) 0%, #34d399 100%);">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h2 class="card-title">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h2>
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-users"></i>
                    Ø¢ÛŒØ¯ÛŒ Ø¢Ù¾Ù„Ø§ÛŒÙ†:
                </label>
                <input type="number" id="uplineId" class="form-input" placeholder="Ù…Ø«Ø§Ù„: 1" min="1">
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-sitemap"></i>
                    Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ù…Ø§ØªØ±ÛŒÚ©Ø³:
                </label>
                <select id="position" class="form-input" style="appearance: none; padding: 24px;">
                    <option value="true">ğŸ‘ˆ Ø³Ù…Øª Ú†Ù¾ (Left)</option>
                    <option value="false">ğŸ‘‰ Ø³Ù…Øª Ø±Ø§Ø³Øª (Right)</option>
                </select>
            </div>
            
            <div class="special-box">
                <div style="font-size: 24px; color: #fbbf24; margin-bottom: 20px; font-weight: 800;">
                    <i class="fas fa-gem"></i> Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                </div>
                <div class="special-amount">300 MATIC</div>
                <div style="color: #fde68a; font-size: 18px; margin-top: 20px;">
                    <i class="fas fa-star"></i> ØªÙˆØ³Ø¹Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
                </div>
            </div>
            
            <button class="action-btn success-btn" id="registerBtn">
                <i class="fas fa-check-circle"></i>
                Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø³ÛŒØ³ØªÙ…
            </button>
        </div>
        
        <div class="glass-card">
            <div class="card-header">
                <div class="header-icon" style="background: linear-gradient(135deg, var(--accent) 0%, var(--accent-glow) 100%);">
                    <i class="fas fa-bolt"></i>
                </div>
                <h2 class="card-title">Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹</h2>
            </div>
            
            <div class="stats-grid">
                <button class="action-btn warning-btn" id="withdrawPoolBtn">
                    <i class="fas fa-money-bill-wave"></i>
                    Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„
                </button>
                
                <button class="action-btn warning-btn" id="withdrawSpecialBtn">
                    <i class="fas fa-crown"></i>
                    Ø¨Ø±Ø¯Ø§Ø´Øª ÙˆÛŒÚ˜Ù‡
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-hand-holding-usd"></i>
                    Ú©Ù…Ú© Ø¨Ù‡ Ø§Ø³ØªØ®Ø± Ù…Ø§ÛŒÙ†Ø± (MATIC):
                </label>
                <input type="number" id="contributeAmount" class="form-input" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" step="0.001" min="0.001">
            </div>
            
            <button class="action-btn" id="contributeBtn" style="background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);">
                <i class="fas fa-donate"></i>
                Ø§Ø±Ø³Ø§Ù„ Ú©Ù…Ú©
            </button>
        </div>
        
        <div class="glass-card">
            <div class="card-header">
                <div class="header-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2 class="card-title">Ø¢Ù…Ø§Ø± Ø´Ø¨Ú©Ù‡</h2>
            </div>
            
            <div class="stats-grid">
                <div class="stat-orb">
                    <div class="stat-label">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</div>
                    <div class="stat-value" id="totalUsers">1,247</div>
                </div>
                <div class="stat-orb">
                    <div class="stat-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù¾ÙˆÙ„</div>
                    <div class="stat-value" id="poolBalance">5,420</div>
                    <div class="stat-label">MATIC</div>
                </div>
                <div class="stat-orb">
                    <div class="stat-label">Ù¾ÙˆÙ„ ÙˆÛŒÚ˜Ù‡</div>
                    <div class="stat-value" id="specialPool">1,850</div>
                    <div class="stat-label">MATIC</div>
                </div>
                <div class="stat-orb">
                    <div class="stat-label">Ù…Ø§ÛŒÙ†Ø±Ù‡Ø§</div>
                    <div class="stat-value" id="minerCount">42</div>
                </div>
            </div>
        </div>
        
        <footer class="main-footer">
            <div style="margin-bottom: 30px;">
                <div style="font-size: 20px; color: #cbd5e1; margin-bottom: 20px; font-weight: 800;">
                    <i class="fas fa-link"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                </div>
                <div class="contract-display" id="contractAddressShort">
                    0x7a7b06D49129B34976D07B3854d4D72D01588191
                </div>
            </div>
            
            <div style="color: #94a3b8; font-size: 14px; line-height: 1.9;">
                <p style="margin-bottom: 12px; font-size: 18px; color: #e2e8f0;">SPS Matrix DApp â€¢ Ø´Ø¨Ú©Ù‡ Polygon Mainnet</p>
                <p style="margin-bottom: 12px;">Ø·Ø±Ø§Ø­ÛŒ Ultimate v4.0 â€¢ Glassmorphism + Neumorphism</p>
                <div style="margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(255, 255, 255, 0.08);">
                    <p style="color: #64748b; font-size: 13px;">
                        <i class="fas fa-mobile-alt"></i> Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† ØªØ¬Ø±Ø¨Ù‡ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± SafePal Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        const CONTRACT_ADDRESS = "0x7a7b06D49129B34976D07B3854d4D72D01588191";
        
        // ABI Ú©Ø§Ù…Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        const CONTRACT_ABI = [{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"message","type":"string"}],"name":"DebugMessage","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"EntryFeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"poolType","type":"string"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ManualWithdraw","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"contributor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"MinerPoolContribution","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"MinerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"MinerTokensBought","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"poolType","type":"string"}],"name":"NoEligibleUsers","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"upline","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"Registered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"}],"name":"UserMigrated","type":"event"},{"inputs":[],"name":"CYCLE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ENTRY_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_CYCLE_BALANCES","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MINER_BUY_INTERVAL","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PTOKEN_CONTRACT","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"_getSpecialUserInfoForMigrateToNewFork","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userAddress","type":"address"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"address","name":"upline","type":"address"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"usersToRemove","type":"address[]"}],"name":"batchRemoveMiners","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"buyMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"contributeToMinerPool","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"distributeMinerTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"eligiblePoolUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"eligibleSpecialUserCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMinerStats","outputs":[{"internalType":"uint256","name":"checkedOutPaidCount","type":"uint256"},{"internalType":"uint256","name":"eligibleInProgressCount","type":"uint256"},{"internalType":"uint256","name":"totalRemain","type":"uint256"},{"internalType":"uint256","name":"networkerCount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"percent","type":"uint256"}],"name":"getMinerStatsByPercent","outputs":[{"internalType":"uint256","name":"usersAbovePercent","type":"uint256"},{"internalType":"uint256","name":"totalRemaining","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSpecialPoolParticipants","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTokenPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"userId","type":"uint256"}],"name":"getUserDirects","outputs":[{"internalType":"uint256","name":"leftId","type":"uint256"},{"internalType":"uint256","name":"rightId","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"uint256","name":"leftCount","type":"uint256"},{"internalType":"uint256","name":"rightCount","type":"uint256"},{"internalType":"uint256","name":"saveLeft","type":"uint256"},{"internalType":"uint256","name":"saveRight","type":"uint256"},{"internalType":"uint256","name":"balanceCount","type":"uint256"},{"internalType":"uint256","name":"specialBalanceCount","type":"uint256"},{"internalType":"uint256","name":"totalMinerRewards","type":"uint256"},{"internalType":"uint256","name":"entryPrice","type":"uint256"},{"internalType":"bool","name":"isMiner","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint8","name":"day","type":"uint8"}],"name":"isCurrentTimeMatchToDay","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isPoolWithdrawable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastMinerBuyTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastPoolWithdrawTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minerTokenPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint256","name":"uplineId","type":"uint256"},{"internalType":"address","name":"leftChildAddress","type":"address"},{"internalType":"address","name":"rightChildAddress","type":"address"},{"internalType":"uint256","name":"oldLeftCount","type":"uint256"},{"internalType":"uint256","name":"oldRightCount","type":"uint256"},{"internalType":"uint256","name":"oldLeftSave","type":"uint256"},{"internalType":"uint256","name":"oldRightSave","type":"uint256"}],"name":"mpu","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"ownerPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pendingMinerFunds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"poolBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"poolPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"poolPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"uplineCode","type":"uint256"},{"internalType":"bool","name":"placeOnLeft","type":"bool"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"specialPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"specialPointCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"specialRewardPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"updateEntryFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"userTokenPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawPool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawSpecials","outputs":[],"stateMutability":"nonpayable","type":"function"}];

        // ==================== GLOBAL VARIABLES ====================
        let provider = null;
        let signer = null;
        let contract = null;
        let userAddress = null;
        let isConnected = false;

        // ==================== HELPER FUNCTIONS ====================
        function showNotification(message, type = 'success', duration = 4000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `advanced-notification ${type}`;
            
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => notification.classList.remove('show'), duration);
        }

        function formatAddress(address) {
            if (!address) return '---';
            return address.substring(0, 6) + '...' + address.substring(address.length - 4);
        }

        function formatMatic(value) {
            if (!value) return '0.00';
            const num = parseFloat(ethers.utils.formatEther(value));
            if (num < 0.001) return '< 0.001';
            return num.toFixed(3);
        }

        // ==================== WALLET & CONTRACT CONNECTION ====================
        async function connectWallet() {
            console.log('ğŸ”„ Connecting wallet and contract...');
            
            // ØªØ´Ø®ÛŒØµ SafePal
            let ethereum = window.ethereum;
            if (!ethereum && window.safepal) {
                ethereum = window.safepal;
                window.ethereum = ethereum;
            }
            
            if (!ethereum) {
                showNotification('âŒ Ù„Ø·ÙØ§Ù‹ SafePal ÛŒØ§ MetaMask Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            try {
                const connectBtn = document.getElementById('connectBtn');
                connectBtn.innerHTML = '<div class="advanced-loader"></div> Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...';
                connectBtn.disabled = true;
                
                // Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„
                const accounts = await ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                if (accounts.length === 0) {
                    throw new Error('Ù‡ÛŒÚ† Ø­Ø³Ø§Ø¨ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯');
                }
                
                userAddress = accounts[0];
                console.log('âœ… Wallet connected:', userAddress);
                
                // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Provider Ùˆ Signer
                provider = new ethers.providers.Web3Provider(ethereum);
                signer = provider.getSigner();
                
                // Ø³Ø§Ø®Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                console.log('âœ… Contract connected');
                
                // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±
                document.getElementById('userPanel').style.display = 'block';
                document.getElementById('walletAddress').textContent = userAddress;
                document.getElementById('status').textContent = 'Ù…ØªØµÙ„';
                document.getElementById('status').style.color = 'var(--secondary)';
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                await updateContractData();
                
                // Ø¢Ù¾Ø¯ÛŒØª UI
                connectBtn.innerHTML = '<i class="fas fa-check"></i> <span>Ù…ØªØµÙ„ Ø´Ø¯</span>';
                connectBtn.style.background = 'linear-gradient(135deg, var(--secondary), #34d399)';
                connectBtn.disabled = false;
                
                showNotification('ğŸ‰ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ùˆ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù…ØªØµÙ„ Ø´Ø¯Ù†Ø¯!', 'success');
                isConnected = true;
                
                // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ø­Ø³Ø§Ø¨
                ethereum.on('accountsChanged', (newAccounts) => {
                    console.log('Accounts changed:', newAccounts);
                    if (newAccounts.length > 0) {
                        userAddress = newAccounts[0];
                        document.getElementById('walletAddress').textContent = userAddress;
                        updateContractData();
                    } else {
                        document.getElementById('userPanel').style.display = 'none';
                        connectBtn.innerHTML = '<i class="fas fa-plug"></i> <span>Ø§ØªØµØ§Ù„ SafePal Wallet</span>';
                        connectBtn.style.background = 'var(--gradient-primary)';
                        connectBtn.style.animation = 'btnPulse 2.5s infinite, borderGlow 3.5s infinite';
                        isConnected = false;
                        showNotification('ğŸ”Œ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù‚Ø·Ø¹ Ø´Ø¯', 'info');
                    }
                });
                
                // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ø´Ø¨Ú©Ù‡
                ethereum.on('chainChanged', (chainId) => {
                    console.log('Chain changed:', chainId);
                    showNotification('Ø´Ø¨Ú©Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...', 'info');
                    setTimeout(() => location.reload(), 1500);
                });
                
            } catch (error) {
                console.error('âŒ Connection error:', error);
                
                const connectBtn = document.getElementById('connectBtn');
                connectBtn.innerHTML = '<i class="fas fa-plug"></i> <span>Ø§ØªØµØ§Ù„ SafePal Wallet</span>';
                connectBtn.disabled = false;
                connectBtn.style.animation = 'btnPulse 2.5s infinite, borderGlow 3.5s infinite';
                
                let errorMsg = 'Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„';
                if (error.code === 4001) errorMsg = 'Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯';
                else if (error.message.includes('not installed')) errorMsg = 'Ú©ÛŒÙ Ù¾ÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯';
                
                showNotification(`âŒ ${errorMsg}`, 'error');
            }
        }

        // ==================== CONTRACT INTERACTIONS ====================
        async function updateContractData() {
            if (!contract || !userAddress || !provider) return;
            
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„
                const balance = await provider.getBalance(userAddress);
                document.getElementById('balance').textContent = formatMatic(balance);
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø¨Ú©Ù‡
                try {
                    const network = await provider.getNetwork();
                    document.getElementById('network').textContent = network.name === 'matic' ? 'Polygon Mainnet' : network.name;
                } catch (networkError) {
                    console.warn('Network detection failed:', networkError);
                    document.getElementById('network').textContent = 'Polygon';
                }
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                try {
                    const totalUsers = await contract.totalUsers();
                    document.getElementById('totalUsers').textContent = totalUsers.toString();
                } catch (e) { console.warn('Could not get totalUsers:', e); }
                
                try {
                    const poolBalance = await contract.poolBalance();
                    document.getElementById('poolBalance').textContent = formatMatic(poolBalance);
                } catch (e) { console.warn('Could not get poolBalance:', e); }
                
                try {
                    const specialPool = await contract.specialRewardPool();
                    document.getElementById('specialPool').textContent = formatMatic(specialPool);
                } catch (e) { console.warn('Could not get specialPool:', e); }
                
                try {
                    const eligibleUsers = await contract.eligiblePoolUserCount();
                    document.getElementById('minerCount').textContent = eligibleUsers.toString();
                } catch (e) { console.warn('Could not get eligibleUsers:', e); }
                
            } catch (error) {
                console.warn('âš ï¸ Error updating contract data:', error);
            }
        }

        async function registerUser() {
            if (!isConnected || !contract) {
                showNotification('âŒ Ù„Ø·ÙØ§Ù‹ Ø§ÙˆÙ„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø±Ø§ Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const uplineId = document.getElementById('uplineId').value;
            const position = document.getElementById('position').value === 'true';
            
            if (!uplineId) {
                showNotification('âŒ Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ø¢Ù¾Ù„Ø§ÛŒÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            try {
                const btn = document.getElementById('registerBtn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<div class="advanced-loader"></div> Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…...';
                btn.disabled = true;
                
                showNotification('â³ Ø§Ø±Ø³Ø§Ù„ ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…...', 'info');
                
                // Ø¯Ø±ÛŒØ§ÙØª entry fee Ø§Ø² Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
                const entryFee = await contract.ENTRY_FEE();
                console.log('Entry fee:', ethers.utils.formatEther(entryFee), 'MATIC');
                
                // Ø§Ø±Ø³Ø§Ù„ ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                const tx = await contract.register(uplineId, position, {
                    value: entryFee,
                    gasLimit: 300000
                });
                
                showNotification('âœ… ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯! Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯...', 'success');
                
                // Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´
                const receipt = await tx.wait();
                console.log('Transaction receipt:', receipt);
                
                showNotification('ğŸ‰ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!', 'success');
                document.getElementById('uplineId').value = '';
                
                // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                await updateContractData();
                
            } catch (error) {
                console.error('Registration error:', error);
                showNotification(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            } finally {
                const btn = document.getElementById('registerBtn');
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø³ÛŒØ³ØªÙ…';
                btn.disabled = false;
            }
        }

        async function withdrawPool() {
            if (!isConnected || !contract) {
                showNotification('âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª', 'error');
                return;
            }
            
            try {
                const btn = document.getElementById('withdrawPoolBtn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<div class="advanced-loader"></div> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª...';
                btn.disabled = true;
                
                showNotification('â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„...', 'info');
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø¨ÙˆØ¯Ù†
                const isWithdrawable = await contract.isPoolWithdrawable();
                if (!isWithdrawable) {
                    throw new Error('Ù¾ÙˆÙ„ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ù†ÛŒØ³Øª');
                }
                
                // Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„
                const tx = await contract.withdrawPool({ gasLimit: 200000 });
                await tx.wait();
                
                showNotification('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯!', 'success');
                await updateContractData();
                
            } catch (error) {
                console.error('Withdraw error:', error);
                showNotification(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            } finally {
                const btn = document.getElementById('withdrawPoolBtn');
                btn.innerHTML = '<i class="fas fa-money-bill-wave"></i> Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„';
                btn.disabled = false;
            }
        }

        async function withdrawSpecial() {
            if (!isConnected || !contract) {
                showNotification('âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª', 'error');
                return;
            }
            
            try {
                const btn = document.getElementById('withdrawSpecialBtn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<div class="advanced-loader"></div> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª...';
                btn.disabled = true;
                
                showNotification('â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„ ÙˆÛŒÚ˜Ù‡...', 'info');
                
                // Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ù¾ÙˆÙ„ ÙˆÛŒÚ˜Ù‡
                const tx = await contract.withdrawSpecials({ gasLimit: 200000 });
                await tx.wait();
                
                showNotification('âœ… Ø¨Ø±Ø¯Ø§Ø´Øª ÙˆÛŒÚ˜Ù‡ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯!', 'success');
                await updateContractData();
                
            } catch (error) {
                console.error('Special withdraw error:', error);
                showNotification(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            } finally {
                const btn = document.getElementById('withdrawSpecialBtn');
                btn.innerHTML = '<i class="fas fa-crown"></i> Ø¨Ø±Ø¯Ø§Ø´Øª ÙˆÛŒÚ˜Ù‡';
                btn.disabled = false;
            }
        }

        async function contributeToMiner() {
            const amount = document.getElementById('contributeAmount').value;
            
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('âŒ Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            if (!isConnected || !contract) {
                showNotification('âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª', 'error');
                return;
            }
            
            try {
                const btn = document.getElementById('contributeBtn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<div class="advanced-loader"></div> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';
                btn.disabled = true;
                
                const value = ethers.utils.parseEther(amount);
                
                showNotification(`â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ ${amount} MATIC...`, 'info');
                
                const tx = await contract.contributeToMinerPool({ 
                    value,
                    gasLimit: 200000
                });
                
                await tx.wait();
                
                showNotification('âœ… Ú©Ù…Ú© Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!', 'success');
                document.getElementById('contributeAmount').value = '';
                await updateContractData();
                
            } catch (error) {
                console.error('Contribution error:', error);
                showNotification(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            } finally {
                const btn = document.getElementById('contributeBtn');
                btn.innerHTML = '<i class="fas fa-donate"></i> Ø§Ø±Ø³Ø§Ù„ Ú©Ù…Ú©';
                btn.disabled = false;
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ SPS Matrix DApp v5.0 Initializing...');
            
            // Ø§ØªØµØ§Ù„ event listeners
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('registerBtn').addEventListener('click', registerUser);
            document.getElementById('withdrawPoolBtn').addEventListener('click', withdrawPool);
            document.getElementById('withdrawSpecialBtn').addEventListener('click', withdrawSpecial);
            document.getElementById('contributeBtn').addEventListener('click', contributeToMiner);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ú©ÙˆØªØ§Ù‡ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
            document.getElementById('contractAddressShort').textContent = 
                CONTRACT_ADDRESS.substring(0, 10) + '...' + CONTRACT_ADDRESS.substring(CONTRACT_ADDRESS.length - 8);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ÛŒ
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            console.log('âœ… Already connected:', accounts[0]);
                            setTimeout(() => connectWallet(), 1500);
                        }
                    });
            }
            
            // Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
            setTimeout(() => {
                showNotification('ğŸŠ Ø¨Ù‡ DApp Ø§Ø³ØªØ®Ø± Ø§ÛŒÙ…Ù† Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!', 'info', 3000);
            }, 1000);
        });
    </script>
</body>
</html>
